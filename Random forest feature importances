import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Assuming ranfor_model and X are already defined
# Get the feature importances
feature_importances = ranfor_model.feature_importances_

# Create a DataFrame with the feature names and their importances
feature_importance_df = pd.DataFrame({'Feature': X.columns, 'Importance': feature_importances})

# Sort the DataFrame by importance in descending order
feature_importance_df = feature_importance_df.sort_values(by='Importance', ascending=False)

# Set up the matplotlib figure with increased size
plt.figure(figsize=(12, 10))

# Create a horizontal bar plot using Seaborn (swap x and y)
sns.barplot(y='Feature', x='Importance', data=feature_importance_df, palette='coolwarm')

# Add titles and labels with adjusted font sizes
plt.title('Random Forest Feature Importances', fontsize=18, fontweight='bold', pad=20)
plt.xlabel('Importance Score', fontsize=14, labelpad=15)
plt.ylabel('Features', fontsize=14, labelpad=15)

# Add gridlines for better readability
plt.grid(axis='x', linestyle='--', alpha=0.7)

# Remove spines for a cleaner look
sns.despine(left=True, bottom=True)

# Annotate the bars with their importance values, limiting to 2 decimal places
for index, value in enumerate(feature_importance_df['Importance']):
    plt.text(value, index, f'{value:.2f}', va='center', fontsize=10, color='black')

# Optional: Add a vertical line to indicate mean importance
plt.axvline(x=feature_importance_df['Importance'].mean(), color='red', linestyle='--', label='Mean Importance')

# Add a legend
plt.legend()

# Adjust layout for better spacing
plt.tight_layout()

# Show the plot
plt.show()
